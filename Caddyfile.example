# OpenTrusty Control Panel - Example Caddyfile

console.opentrusty.localhost {
    # 1. Serve static files from the build output
    root * /var/www/opentrusty-control-panel/dist
    file_server

    # 2. Proxy API requests to the Admin Plane
    handle_path /api/* {
        reverse_proxy localhost:8081
    }

    # 3. Proxy Auth requests to the Auth Plane (if needed by UI)
    handle_path /auth/* {
        reverse_proxy localhost:8080
    }

    # 4. Handle Single Page Application (SPA) routing
    try_files {path} /index.html

    # Security Headers
    header {
        # Disable FLoC
        Permissions-Policy "interest-cohort=()"
        # Prevent XSS
        X-XSS-Protection "1; mode=block"
        # Prevent MIME sniffing
        X-Content-Type-Options "nosniff"
        # Referrer Policy
        Referrer-Policy "strict-origin-when-cross-origin"
        # Content Security Policy (Basic - Adjust for your environment)
        Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self' http://localhost:8081 http://localhost:8080;"
    }
}
